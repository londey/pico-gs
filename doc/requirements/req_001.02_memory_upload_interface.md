# REQ-001.02: Memory Upload Interface

## Classification

- **Priority:** Essential
- **Stability:** Stable
- **Verification:** Test

## Requirement

When the host initiates a memory transfer by writing to the MEM_ADDR register followed by one or more writes or reads of the MEM_DATA register, the system SHALL transfer each 64-bit dword at the current SDRAM dword address and auto-increment the address by 1 after each access, enabling bulk upload and readback of textures, lookup tables, and other GPU memory content via SPI without pre-programming SDRAM.
The MEM_ADDR register is 22 bits wide, addressing 8-byte dwords across the full 32 MiB SDRAM.
Writing MEM_ADDR SHALL trigger a read prefetch so that subsequent SPI reads of MEM_DATA return data immediately.

## Rationale

The GPU's SDRAM is volatile and is unprogrammed at power-on.
The host firmware must be able to populate texture data, color grading LUTs, and other content at runtime via the existing SPI register interface.
Auto-incrementing the MEM_ADDR pointer after each MEM_DATA access minimizes SPI transactions for bulk transfers.
Using 64-bit dwords doubles the effective throughput (~6 MB/s vs ~3 MB/s at 25 MHz SPI) by filling the full 64-bit data phase of each 72-bit SPI transaction.
This requirement supersedes and incorporates REQ-029, which was a duplicate functional-form counterpart.

## Parent Requirements

- REQ-005 (Blend/Frame Buffer Store)

## Allocated To

- UNIT-003 (Register File)
- UNIT-007 (SRAM Arbiter)

## Interfaces

- INT-010 (GPU Register Map)
- INT-011 (SDRAM Memory Layout)

## Verification Method

**Test:** Execute the memory upload interface test suite:

- [ ] Write a known value to MEM_ADDR; confirm subsequent MEM_DATA write stores the 64-bit dword at that SDRAM dword address.
- [ ] After a MEM_DATA write, confirm MEM_ADDR has auto-incremented by 1.
- [ ] Read from MEM_DATA at the same address; confirm the returned 64-bit value matches the previously written dword.
- [ ] Upload a 1 KB block of known data; confirm all 128 dwords are present in SDRAM at the expected addresses (≤130 SPI transactions at 25 MHz SPI ≈ 0.4 ms).
- [ ] Read back the 1 KB block via MEM_DATA reads; confirm all dwords match.
- [ ] Perform a bulk upload of a full 256×256 RGBA4444 texture; confirm all texel data is correct in SDRAM.

## Notes

This requirement incorporates and retires REQ-029 (Memory Upload Interface — functional counterpart).
UNIT-003 (Register File) implements the MEM_ADDR and MEM_DATA register logic.
UNIT-007 (SRAM Arbiter) arbitrates SDRAM access for host memory upload requests.
