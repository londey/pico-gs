# REQ-005.08: Clear Framebuffer

## Classification

- **Priority:** Essential
- **Stability:** Stable
- **Verification:** Test

## Requirement

When the host writes the MEM_FILL register (INT-010, index 0x44) with a base address, a 16-bit fill value, and a word count, the system SHALL write that fill value to every specified 16-bit SDRAM word using sequential burst writes, blocking the GPU command pipeline until the fill completes, and SHALL leave framebuffer and Z-buffer words outside the specified range unmodified.

## Rationale

A framebuffer clear establishes a known starting state before geometry is rendered each frame.
Without clearing, residual pixel data and depth values from the previous frame produce visual corruption.
The MEM_FILL hardware fill issues direct sequential SDRAM burst writes, achieving maximum fill throughput without rasterizer setup overhead.
Clearing the back-buffer (not the displayed front-buffer) prevents visible tearing during the clear operation.
Because both the color buffer and Z-buffer use 4×4 block-tiled layout with contiguous SDRAM addressing (INT-011), a single MEM_FILL covers any power-of-two surface with no block-aware addressing required.

## Parent Requirements

- REQ-005 (Blend/Frame Buffer Store)

## Allocated To

- UNIT-022 (GPU Driver Layer)
- UNIT-007 (Memory Arbiter)
- UNIT-021 (Core 1 Render Executor)

## Interfaces

- INT-010 (GPU Register Map)
- INT-011 (SDRAM Memory Layout)
- INT-020 (GPU Driver API)

## Verification Method

**Test:** Issue a MEM_FILL command with a known fill color for the color buffer, then a second MEM_FILL with 0xFFFF for the Z-buffer.
Read back all pixels of the cleared color buffer and verify every pixel matches the specified fill color.
Read back all Z-buffer locations and verify every value is 0xFFFF (far-plane depth).
Verify that the displayed front-buffer is unmodified during the clear operation.

## Notes

The driver layer (UNIT-022) computes FILL_BASE and FILL_COUNT from the active framebuffer base address and surface dimensions defined in FB_CONFIG (INT-010): `FILL_COUNT = (1 << WIDTH_LOG2) * (1 << HEIGHT_LOG2)`.
For example, a 512×512 surface (WIDTH_LOG2=9, HEIGHT_LOG2=9) gives FILL_COUNT = 262,144 words per buffer; a 256×256 surface (WIDTH_LOG2=8, HEIGHT_LOG2=8) gives 65,536 words.
Triangle-based clearing (REQ-005.05) remains available for partial clears, gradient fills, or pattern fills where a constant fill value is insufficient.
