# REQ-002.03: Rasterization Algorithm

## Classification

- **Priority:** Essential
- **Stability:** Stable
- **Verification:** Test

## Requirement

When a triangle is submitted via the vertex registers and TRI_DRAW is written, the system SHALL compute edge function coefficients and a screen-clamped bounding box (UNIT-004), then iterate over all pixels within the bounding box using edge walking (UNIT-005), emitting per-fragment data (x, y, z, color0, color1, uv0, uv1, q) to the pixel pipeline (UNIT-006) via a valid/ready handshake for each pixel that passes the edge function inside test.

When the rasterizer emits fragments at the 100 MHz core clock rate, the system SHALL sustain a peak throughput of one fragment evaluation per clock cycle, yielding up to 100 million fragment evaluations per second.

## Rationale

Edge-function rasterization with scanline-order edge walking provides deterministic traversal of the triangle bounding box.
Operating at 100 MHz (unified GPU core clock), the rasterizer achieves double the throughput compared to a 50 MHz design, enabling higher fill rates for complex scenes.
The rasterizer emits a structured fragment bus to UNIT-006 (Pixel Pipeline), which owns framebuffer and Z-buffer SDRAM writes.
See UNIT-004 (Triangle Setup), UNIT-005 (Rasterizer), and UNIT-006 (Pixel Pipeline) for implementation details.

## Parent Requirements

- REQ-002 (Rasterizer)

## Allocated To

- UNIT-004 (Triangle Setup)
- UNIT-005 (Rasterizer)

## Interfaces

- INT-010 (GPU Register Map)
- INT-011 (SDRAM Memory Layout)

## Verification Method

**Test:** VER-001 (tb_rasterizer) verifies this requirement by driving the triangle-setup and rasterizer RTL under Verilator, checking edge function coefficients, bounding box clamping, and fragment emission count against reference values.

## Notes

Functional requirements grouped from specification.

**Throughput**: At 100 MHz core clock, the rasterizer (UNIT-005) evaluates one pixel per cycle in the inner loop.
Effective fill rate is limited by SDRAM bandwidth contention with display scanout and Z-buffer operations (see INT-011 bandwidth budget).
The theoretical peak of 100 Mpixels/sec evaluations translates to approximately 25 Mpixels/sec sustained write throughput after arbitration overhead.

**Incremental interpolation**: The rasterizer uses precomputed attribute derivatives (dAttr/dx, dAttr/dy) from UNIT-004 to step attribute values across scanlines via addition only, replacing per-pixel barycentric multiply-accumulate.
This substantially reduces DSP usage compared to the barycentric MAC approach, creating headroom for UV0, UV1, and perspective-correct Q interpolation.
See UNIT-005 for the derivative precomputation and stepping implementation.

**Fragment output bus**: The rasterizer emits fragments in scanline order (left-to-right) to UNIT-006 via a valid/ready handshake.
Each fragment carries x, y, z, color0, color1, uv0, uv1, and q.
Format annotations: color0 and color1 are Q4.12 RGBA (64 bits each); uv0 and uv1 are Q4.12 per component (U[31:16], V[15:0] packed into 32 bits); q is Q3.12 (16 bits); z is a 16-bit unsigned depth value.
UNIT-006 (Pixel Pipeline) is responsible for texture fetch, color combining, alpha blending, and all SDRAM writes (framebuffer and Z-buffer).
See UNIT-007 for arbiter burst mode handling of framebuffer and Z-buffer writes with the 4x4 block-tiled layout (INT-011).
